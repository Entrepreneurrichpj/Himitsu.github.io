<!DOCTYPE html>
<html>
<head>
    <title>Message System</title>
</head>
<style>
        body {
            background: linear-gradient(to right, #ffffff, #f0f0f0);
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
        }

        #left-side {
            width: 40%;
            padding: 20px;
        }

        #right-side {
            width: 60%;
            padding: 20px;
            background-color: #ffffff;
            border-left: 1px solid #d0d0d0;
        }

        h1 {
            text-align: center;
        }

        label {
            font-weight: bold;
        }

        input, textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        h2 {
            margin-top: 20px;
        }

        #receivedMessages {
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f0f0f0;
        }

        #connectionStatus {
            font-weight: bold;
        }
<body>
    <h1>Message System</h1>

    <!-- Input fields for sending a message -->
    <label for="toChainId">To Chain ID:</label>
    <input type="number" id="toChainId" placeholder="Enter Chain ID"><br>

    <label for="toAddress">To Address:</label>
    <input type="text" id="toAddress" placeholder="Enter Address"><br>

    <label for="message">Message:</label>
    <textarea id="message" rows="4" cols="50" placeholder="Enter your message"></textarea><br>

    <label for="feeAmount">Fee Amount (ETH):</label>
    <input type="number" id="feeAmount" placeholder="Enter Fee Amount"><br>

    <button onclick="connectWallet()">Connect Wallet</button>
    <button onclick="sendMessage()">Send Message</button>

    <!-- Display received messages -->
    <h2>Received Messages:</h2>
    <div id="receivedMessages"></div>

    <!-- Added function to check wallet connection -->
    <button onclick="checkWalletConnection()">Check Wallet Connection</button>
    <div id="connectionStatus"></div>

    <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>

    <script>
        // Replace with the actual contract address and ABI
        const contractAddress = "0x8abdc2cBf215cD242b61A4C748aa5647240817D6";
        const contractAbi = [
            // Define the ABI of your smart contract here
            0xd6ead4c54abd44e904520f87788eeb7c588d8c6869374968c8006b9178be339f
        ];

        // Replace with your Ethereum node URL
        const ethereumNodeUrl = "YOUR_ETHEREUM_NODE_URL";

        async function initWeb3() {
            if (typeof web3 !== 'undefined') {
                window.web3 = new Web3(web3.currentProvider);
            } else {
                window.web3 = new Web3(new Web3.providers.HttpProvider(ethereumNodeUrl));
            }

            const accounts = await web3.eth.getAccounts();

            if (accounts.length === 0) {
                alert("Please connect to MetaMask or another Ethereum wallet.");
            } else {
                const userAddress = accounts[0];
                // You can also update a UI element to display the user's address.
            }
        }

        async function connectWallet() {
            try {
                // Request user's permission to connect their Ethereum wallet
                await ethereum.request({ method: 'eth_requestAccounts' });
                
                // Check if the user is connected
                if (ethereum.selectedAddress) {
                    const userAddress = ethereum.selectedAddress;
                    alert(`Connected Ethereum Address: ${userAddress}`);
                } else {
                    alert("Wallet connection was canceled or failed.");
                }
            } catch (error) {
                console.error("Wallet Connection Error:", error.message);
            }
        }

        async function sendMessage() {
            const toChainId = document.getElementById("toChainId").value;
            const toAddress = document.getElementById("toAddress").value;
            const message = document.getElementById("message").value;
            const feeAmount = web3.utils.toWei(document.getElementById("feeAmount").value, 'ether');

            const accounts = await web3.eth.getAccounts();
            const senderAddress = accounts[0];

            const contract = new web3.eth.Contract(contractAbi, contractAddress);

            try {
                const result = await contract.methods.sendEncryptedMessage(
                    toChainId,
                    toAddress,
                    message,
                    feeAmount
                ).send({ from: senderAddress });

                const transactionHash = result.transactionHash;
                console.log("Transaction Hash:", transactionHash);

                const sentMessage = `To Chain ID: ${toChainId}, To Address: ${toAddress}, Message: ${message}, Fee Amount (ETH): ${web3.utils.fromWei(feeAmount, 'ether')}`;
                const sentMessageElement = document.createElement("p");
                sentMessageElement.textContent = sentMessage;
                document.getElementById("receivedMessages").appendChild(sentMessageElement);

                document.getElementById("toChainId").value = "";
                document.getElementById("toAddress").value = "";
                document.getElementById("message").value = "";
                document.getElementById("feeAmount").value = "";
            } catch (error) {
                console.error("Transaction Error:", error.message);
            }
        }

        // Function to check wallet connection status
        function checkWalletConnection() {
            if (ethereum.selectedAddress) {
                document.getElementById("connectionStatus").textContent = `Connected Ethereum Address: ${ethereum.selectedAddress}`;
            } else {
                document.getElementById("connectionStatus").textContent = "Wallet is not connected.";
            }
        }

        window.addEventListener('load', function () {
            initWeb3();
        });
    </script>
</body>
</html>
